# üéôÔ∏è WhisperX Protocol Manager

–ù–µ–±–æ–ª—å—à–æ–µ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ FastAPI –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏ –∞—É–¥–∏–æ—Ñ–∞–π–ª–æ–≤ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –¥–∏–∞—Ä–∏–∑–∞—Ü–∏–∏ —Å–ø–∏–∫–µ—Ä–æ–≤ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫—Ä–∞—Ç–∫–∏—Ö –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è.

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

1. üì§ –ó–∞–≥—Ä—É–∑–∫–∞ –∞—É–¥–∏–æ—Ñ–∞–π–ª–æ–≤ —Ñ–æ—Ä–º–∞—Ç–æ–≤: `ogg`, `wav`, `mp3`, –∏ –¥—Ä.
2. üìù –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è –∞—É–¥–∏–æ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Å–∫–∞—á–∞—Ç—å —Ç–µ–∫—Å—Ç.
3. üßë‚Äçü§ù‚Äçüßë –ü–æ–¥–¥–µ—Ä–∂–∫–∞ **–¥–∏–∞—Ä–∏–∑–∞—Ü–∏–∏ —Å–ø–∏–∫–µ—Ä–æ–≤** (–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ "–∫—Ç–æ –∏ –∫–æ–≥–¥–∞ –≥–æ–≤–æ—Ä–∏–ª") —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —É–∫–∞–∑–∞–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≥–æ–≤–æ—Ä—è—â–∏—Ö.
4. üß† –ì–µ–Ω–µ—Ä–∞—Ü–∏—è **–ø—Ä–æ—Ç–æ–∫–æ–ª–∞/–∫–æ–Ω—Å–ø–µ–∫—Ç–∞** –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏.
5. ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏ (–º–æ–¥–µ–ª—å, –∫–∞—á–µ—Å—Ç–≤–æ –∏ –¥—Ä.).
6. üí¨ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–¥–∞–≤–∞—Ç—å **–ø—Ä–æ–º–ø—Ç—ã** (–ø–æ–¥—Å–∫–∞–∑–∫–∏) –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏ –∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–∏—Ä–æ–≤–∞–Ω–∏—è.

## üì∏ –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

[![–ì–ª–∞–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è](https://i.ibb.co/Z1R5nnvF/wxpm.png)](https://ibb.co/vvCp77fT)

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
‚îú‚îÄ‚îÄ app.py                  # –æ—Å–Ω–æ–≤–Ω–æ–π FastAPI —Å–µ—Ä–≤–µ—Ä
‚îú‚îÄ‚îÄ index.html              # –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚îú‚îÄ‚îÄ styles.css              # —Å—Ç–∏–ª–∏
‚îú‚îÄ‚îÄ requirements.txt        # –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ .env                    # –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ prompts/                # –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –ø—Ä–æ–º–ø—Ç—ã (—Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã .txt)
‚îî‚îÄ‚îÄ reference_voices/       # –≥–æ–ª–æ—Å–æ–≤—ã–µ –æ–±—Ä–∞–∑—Ü—ã –¥–ª—è –¥–∏–∞—Ä–∏–∑–∞—Ü–∏–∏
```

## üõ†Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- [FastAPI](https://fastapi.tiangolo.com/)
- [WhisperX](https://github.com/m-bain/whisperx)
- [PyAnnote-Audio](https://github.com/pyannote/pyannote-audio)
- [Hugging Face Transformers](https://huggingface.co/)
- [Gemini API (Google)](https://ai.google.dev/)

## üß† –î–∏–∞—Ä–∏–∑–∞—Ü–∏—è –∏ –±–∞–Ω–∫ –≥–æ–ª–æ—Å–æ–≤

–î–ª—è –¥–∏–∞—Ä–∏–∑–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–≥–æ–ª–æ—Å–æ–≤–æ–π –±–∞–Ω–∫ (reference voices)**.  
–ß—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–π –≥–æ–ª–æ—Å, –ø–æ–º–µ—Å—Ç–∏—Ç–µ **–æ—Ç—Ä—ã–≤–æ–∫ —Ä–µ—á–∏ –¥–ª–∏–Ω–æ–π –æ—Ç 15 –¥–æ 30 —Å–µ–∫—É–Ω–¥** –≤ –ø–∞–ø–∫—É `reference_voices/`.  
–ò–º—è —Ñ–∞–π–ª–∞ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–∞–∫ –º–µ—Ç–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `ivan.wav` ‚Üí `ivan:` –≤ —Ç–µ–∫—Å—Ç–µ).

> –ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω—ã –∫–∞—Å—Ç–æ–º–Ω—ã–µ –≥–æ–ª–æ—Å–∞, –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —Å–ø–∏–∫–µ—Ä–æ–≤.

## üí¨ –ü—Ä–æ–º–ø—Ç—ã

–î–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –∏ –∫–æ–Ω—Å–ø–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å **–ø—Ä–æ–º–ø—Ç—ã**.  
–†–∞–∑–º–µ—Å—Ç–∏—Ç–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –≤ –≤–∏–¥–µ `.txt` —Ñ–∞–π–ª–æ–≤ –≤ –ø–∞–ø–∫–µ `prompts/`.  
–ù–∞–ø—Ä–∏–º–µ—Ä:
- `context.txt` ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ —Å–∏—Ç—É–∞—Ü–∏–∏ (–ª–µ–∫—Ü–∏—è, —Å–æ–≤–µ—â–∞–Ω–∏–µ –∏ —Ç.–¥.)
- `names.txt` ‚Äî —Å–ø–∏—Å–æ–∫ –≤–æ–∑–º–æ–∂–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞
- `vocabulary.txt` ‚Äî —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è –ø–æ —Ç–µ–º–µ

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
git clone https://github.com/yourusername/audio-transcriber-api.git
cd audio-transcriber-api
python -m venv venv
source venv/bin/activate  # –∏–ª–∏ .\venv\Scripts\activate –¥–ª—è Windows
pip install -r requirements.txt
```

–°–æ–∑–¥–∞–π—Ç–µ .env —Ñ–∞–π–ª –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:
```
# –¢–æ–∫–µ–Ω Hugging Face –¥–ª—è pyannote
HUGGINGFACE_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω

# API –∫–ª—é—á Gemini
GEMINI_API_KEY=–≤–∞—à_–∫–ª—é—á

# –ü—Ä–æ–∫—Å–∏ (–µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ)
HTTP_PROXY=
HTTPS_PROXY=

# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã WhisperX
MODEL_NAME=large-v3
COMPUTE_TYPE=int8

# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–∏–∞—Ä–∏–∑–∞—Ü–∏–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ)
MIN_SPEAKERS=2
MAX_SPEAKERS=2
SEGMENTATION_THRESHOLD=0.60
SEGMENTATION_MIN_DURATION_OFF=0.20
CLUSTERING_THRESHOLD=0.50
CLUSTERING_MIN_CLUSTER_SIZE=8
```
## üîê –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### Hugging Face Access
–î–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∏–∞—Ä–∏–∑–∞—Ü–∏–µ–π —á–µ—Ä–µ–∑ PyAnnote –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:
1. –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω –Ω–∞ [Hugging Face](https://huggingface.co/settings/tokens)
2. **–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Å–ª–µ–¥—É—é—â–∏–º –º–æ–¥–µ–ª—è–º:**
   - [pyannote/segmentation](https://huggingface.co/pyannote/segmentation)
   - [pyannote/speaker-diarization](https://huggingface.co/pyannote/speaker-diarization)
3. –î–ª—è –∫–∞–∂–¥–æ–π –º–æ–¥–µ–ª–∏ –Ω—É–∂–Ω–æ:
   - –ü–µ—Ä–µ–π—Ç–∏ –ø–æ —Å—Å—ã–ª–∫–µ
   - –ù–∞–∂–∞—Ç—å "Agree to access"
   - –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

### Gemini API
–î–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ —Ç—Ä–µ–±—É–µ—Ç—Å—è:
1. –ü–æ–ª—É—á–∏—Ç—å API –∫–ª—é—á –≤ [Google AI Studio](https://ai.google.dev/)
2. –î–æ–±–∞–≤–∏—Ç—å –µ–≥–æ –≤ `.env` —Ñ–∞–π–ª –∫–∞–∫ `GEMINI_API_KEY`

‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫
```
uvicorn app:app --reload
```

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: http://localhost:8000

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è                       | –û–ø–∏—Å–∞–Ω–∏–µ                                                                 |
|----------------------------------|--------------------------------------------------------------------------|
| `MODEL_NAME`                     | –ú–æ–¥–µ–ª—å WhisperX (`base`, `medium`, `large-v3`)                           |
| `COMPUTE_TYPE`                   | –¢–∏–ø –≤—ã—á–∏—Å–ª–µ–Ω–∏–π (`int8`, `float16`, `float32`)                            |
| `MIN_SPEAKERS`, `MAX_SPEAKERS`  | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º—ã—Ö —Å–ø–∏–∫–µ—Ä–æ–≤ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ)  |
| `SEGMENTATION_THRESHOLD`        | –ü–æ—Ä–æ–≥ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –¥–ª—è —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ —Ä–µ—á–∏ (–æ–ø—Ç–∏–º—É–º `0.60`)                 |
| `SEGMENTATION_MIN_DURATION_OFF` | –ú–∏–Ω. –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç–∏—à–∏–Ω—ã –º–µ–∂–¥—É —Å–µ–≥–º–µ–Ω—Ç–∞–º–∏ (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö)             |
| `CLUSTERING_THRESHOLD`          | –ü–æ—Ä–æ–≥ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è —Å–µ–≥–º–µ–Ω—Ç–æ–≤ –æ–¥–Ω–æ–≥–æ —Å–ø–∏–∫–µ—Ä–∞                              |
| `CLUSTERING_MIN_CLUSTER_SIZE`   | –ú–∏–Ω. –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ–≥–º–µ–Ω—Ç–æ–≤ –≤ –æ–¥–Ω–æ–º –∫–ª–∞—Å—Ç–µ—Ä–µ                               |

## üìÑ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

- **–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞:**  
  –ó–∞–≥—Ä—É–∑–∏—Ç–µ –∞—É–¥–∏–æ—Ñ–∞–π–ª —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.

- **–î–∏–∞—Ä–∏–∑–∞—Ü–∏—è:**  
  –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ñ–ª–∞–≥ "–î–∏–∞—Ä–∏–∑–∞—Ü–∏—è", –≤—ã–±–µ—Ä–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ø–∏–∫–µ—Ä–æ–≤ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–∞—Å—Ç–æ–º–Ω—ã–µ –≥–æ–ª–æ—Å–∞ (–ø–∞–ø–∫–∞ `reference_voices/`).

- **–ü—Ä–æ–º–ø—Ç—ã:**  
  –î–æ–±–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –≤ –ø–∞–ø–∫—É `prompts/` –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏.
